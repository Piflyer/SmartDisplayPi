<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <link href='../style.css' rel='stylesheet' />
    <title>Settings</title>
    <script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
    <style>
        /* The Modal (background) */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            /* Could be more or less, depending on screen size */
        }

        /* The Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        #icons img {
            width: 50px;
            height: 50px;
        }
    </style>
</head>

<body>

<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <span class="close">&times;</span><br>
        <form onsubmit="createApp();">
            Name: <input data-kioskboard-type="keyboard" required id="name2" type="text"><br>
            URL: <select id="protocol">
            <option value="http://">http</option>
            <option value="https://">https</option>
            <option value="http://">IDK</option>
        </select> :// <input data-kioskboard-specialcharacters="true" id="url" required type="text"><br>
            <input type="hidden" id="icon" value="/media/website.png">
            Icon: <button type="button" onclick="openIconForm()"><img id="icon-preview" style="height: 100px; width: 100px" src="../media/website.png"></button><br>
            <input type="submit" value="Done">
        </form>

    </div>

</div>
<!-- The Modal -->
<div id="iconModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <span class="close">&times;</span><br>
            <input type="text" oninput="search(this.value)" />
            <div id="icons"></div>
            <script src="../scripts/iconPicker.js"></script>
    </div>

</div>
<div id="settingsMenuBar"><span onclick="window.location = '../settings.html'"><svg
        xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
        class="bi bi-arrow-left-circle-fill" viewBox="0 0 16 16">
                <path
                        d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z" />
            </svg> Application Settings</span></div>
<br><br>
<h1>
    Apps
</h1>

<ul id="ul">
    <li onclick="openForm()"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                  class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
        <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z" />
    </svg> New</li>
</ul>
<script src="../scripts/universal.js"></script>
<script>
    function openForm() {
        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        modal.style.display = "block";

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    }
    function openIconForm() {
        // Get the modal
        var modal = document.getElementById("iconModal");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[1];

        modal.style.display = "block";

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    }
    var apps = settings.get("apps", defaultApps);
    function refreshApps() {
        document.getElementById("ul").innerHTML = `<li onclick="openForm()"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                  class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
        <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z" />
    </svg> New</li>`;
        apps.forEach(app => {
            var li = document.createElement("li");
            li.innerHTML = app.name + ` <a onclick="deleteApp('` + app.name + `')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-x-circle-fill" viewBox="0 0 16 16">
                <path
                    d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z" />
            </svg></a>`;
            document.getElementById("ul").appendChild(li);
        });
    }
    window.onload = () => {
        refreshApps();
    }
    function deleteApp(name) {
        apps.splice(apps.findIndex(item => item.name === name), 1);
        settings.set("apps", apps);
        refreshApps();
    }
    function createApp() {
        if (apps.findIndex(item => item.name === document.getElementById("name2").value) !== -1) {
            alert("App with that name already exists! Please choose another name or delete the existing app.");
            return;
        }
        apps.push(
            {
                name: document.getElementById("name2").value, href: "/webview.html?url=" + encodeURIComponent(document.getElementById("protocol").value + document.getElementById("url").value), icon: "https://www.google.com/s2/favicons?domain=" + document.getElementById("url").value
            });
        settings.set("apps", apps);
        refreshApps();
    }
</script>
</body>

</html>