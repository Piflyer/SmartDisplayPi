<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <link href='../style.css' rel='stylesheet' />
    <title>Settings</title>
    <script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        /* The Modal (background) */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            /* Could be more or less, depending on screen size */
        }

        /* The Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        input[type=text] {
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 3px solid #ccc;
            -webkit-transition: 0.5s;
            transition: 0.5s;
            outline: none;
        }

        input[type=submit] {
            padding: 12px 20px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 3px solid #ccc;
            background-color: white;
            -webkit-transition: 0.5s;
            transition: 0.5s;
            outline: none;
        }

        input[type=text]:focus,
        input[type=submit]:hover {
            border: 3px solid #555;
        }
    </style>
</head>

<body>

    <!-- The Modal -->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span><br>
            <form onsubmit="createWidget();">
                Name: <input oninput="updatePreview('name');" required id="name2" type="text"><br>
                URL (Including Protocol): <input oninput="updatePreview('url');" id="url" required type="text"><br>
                Preview:
                <div id="preview" class="widget">
                    <h3></h3>
                    <webview
                        useragent="Mozilla/5.0 (Linux; Android 12; Pixel 6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.104 Mobile Safari/537.36 SmartDisplayPi">
                    </webview>
                </div>
                <input type="submit" value="Done">

            </form>

        </div>

    </div>
    <div id="settingsMenuBar"><span onclick="window.location = '../settings.html'"><svg
                xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                class="bi bi-arrow-left-circle-fill" viewBox="0 0 16 16">
                <path
                    d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z" />
            </svg> Home Page Settings</span></div>
    <br><br><br>
    <script>
        // For some reason, I need to define them here and not in the universal.js file.
        const Store = require('electron-store');
        const settings = new Store();
    </script>

    <h1>
        Widgets
    </h1>

    <ul id="ul">
        <li onclick="openForm()"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
                <path
                    d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z" />
            </svg> New</li>
    </ul>
    <a href="#" onclick="settings.set(`editingHome`, true); window.location = '../index.html'">Edit widget
        locations</a><br><br>
    <input type="checkbox" oninput="settings.set('autoloadWidgets', this.checked)" id="autoload"> <label
        for="autoload">Autoload widgets on startup (highly
        unrecommended)</label>
    <p>Widget width:
        30px <input id="width" oninput="changeSize()" type="range" min="30" max="500"> 500px</p>
    <p>Widget height:
        30px <input id="height" oninput="changeSize()" type="range" min="30" max="500"> 500px</p>
    <div style="background-color: black; color: white;" id="example">Widgets look like this</div>
    <script>
        document.getElementById("width").value = settings.get("widgetWidth", 200);
        document.getElementById("height").value = settings.get("widgetHeight", 200);
        document.getElementById("preview").style.width = settings.get("widgetWidth", 200) + "px";
        document.getElementById("preview").style.height = settings.get("widgetHeight", 200) + "px";
        document.getElementById("autoload").checked = settings.get("autoloadWidgets", false);
        function changeSize() {
            document.getElementById("example").style.width = document.getElementById("width").value + "px";
            document.getElementById("example").style.height = document.getElementById("height").value + "px";
            settings.set("widgetWidth", document.getElementById("width").value);
            settings.set("widgetHeight", document.getElementById("height").value);

        }
        changeSize();
        function openForm() {
            // Get the modal
            var modal = document.getElementById("myModal");

            // Get the <span> element that closes the modal
            var span = document.getElementsByClassName("close")[0];

            modal.style.display = "block";

            // When the user clicks on <span> (x), close the modal
            span.onclick = function () {
                modal.style.display = "none";
            }

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }
        var widgets = settings.get("widgets", [
            {
                name: "Traffic",
                url: "https://www.google.com/maps/"
            },
            {
                name: "Weather",
                url: "https://weather.com/weather/today/"
            },
            {
                name: "Calendar",
                url: "https://calendar.google.com/calendar/u/0/r/customday"
            }]);
        window.onload = () => {
            widgets.forEach(widget => {
                var li = document.createElement("li");
                li.innerHTML = widget.name + ` <a onclick="deleteWidget('` + widget.name + `')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-x-circle-fill" viewBox="0 0 16 16">
                <path
                    d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z" />
            </svg></a>`
                document.getElementById("ul").appendChild(li);
            });
        }
        function deleteWidget(name, url) {
            // All of this was automatically generated by GitHub Copilot. Creepy. Worked first try without any editing.
            widgets.splice(widgets.findIndex(item => item.name === name), 1);
            settings.set("widgets", widgets);
            window.location.reload();
            settings.delete("dragPositions");

        }
        function createWidget() {
            // I'm gonna be out of a job soon.
            if (widgets.findIndex(item => item.name === document.getElementById("name2").value) !== -1) {
                alert("Widget with that name already exists! Please choose another name or delete the existing widget.");
                return;
            }
            widgets.push(
                {
                    name: document.getElementById("name2").value, url: document.getElementById("url").value
                });
            settings.set("widgets", widgets);
            settings.delete("dragPositions");
        }
        function updatePreview(part) {
            if (part == "name") {
                document.getElementById("preview").getElementsByTagName("h3")[0].innerHTML = document.getElementById("name2").value;
            }
            else if (part == "url") {
                document.getElementById("preview").getElementsByTagName("webview")[0].src = "../notloaded.html?url=" + document.getElementById("url").value;
            }
        }
    </script>
    </div>
</body>

</html>